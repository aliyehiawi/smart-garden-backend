#!/bin/sh
#
# Pre-commit hook to run static code analysis
# This hook runs Checkstyle and SpotBugs before allowing a commit
#
# Installation:
#   Copy this file to .git/hooks/pre-commit and make it executable:
#   - Linux/Mac: chmod +x .git/hooks/pre-commit
#   - Windows: Git Bash will handle permissions automatically
#

echo "Running static code analysis..."

# Force rerun to avoid Gradle cache issues with staged files
./gradlew codeQuality --rerun-tasks --console=plain

RESULT=$?

if [ $RESULT -ne 0 ]; then
    echo ""
    echo "❌ Code quality checks failed!"
    echo "Please fix the violations before committing."
    echo ""
    echo "View reports:"
    echo "  - Checkstyle: build/reports/checkstyle/main.html"
    echo "  - SpotBugs:   build/reports/spotbugs/main.html"
    echo ""
    echo "To bypass this check (NOT RECOMMENDED):"
    echo "  git commit --no-verify"
    echo ""
    exit 1
fi

echo "✅ Code quality checks passed!"
exit 0

